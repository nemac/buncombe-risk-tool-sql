create extension tablefunc;
drop table if exists road_flood_bg_tab;
drop table if exists road_flood_classification;

create or replace view road_flood as 
select a.* from streets_buncombe as a 
join fl1yr as b 
on ST_intersects(a.geom, b.geom);

create table road_flood_bg_tab as 
select a.gid, a.road_class as class, (ST_Length(ST_Transform(a.geom, 2877))/5280) as miles, a.geom as geom, b.blkgrpce as bg_id from road_flood as a 
join nc_cblockgroups as b 
on st_intersects(a.geom, b.geom);

create table roads_flooded_bg_class_tab as 
select sum(sum), class, bg_id, geom
from road_flood_classification 
group by class, bg_id
order by class asc;

